# 更新日志

## v2.0.1 - 紧急修复版本 (2026-02-12)

### 🐛 Bug 修复

#### 关键修复
- ✅ **修复游戏无法启动** - 解决 `gameDiamonds` 初始化错误
  - 将 `gameDiamonds` 和 `totalCoinsCollected` 移到全局作用域
  - 修复 `Uncaught ReferenceError: Cannot access 'gameDiamonds' before initialization`
  
- ✅ **修复收款码不显示** - 充值弹窗现在正确显示收款码
  - 打开充值弹窗时自动调用 `updateRechargeQRCodes()`
  - 支付宝和微信收款码正常显示

#### 游戏平衡优化
- ✅ **降低初始难度** - 优化新手体验
  - 障碍物生成概率：0.01 → 0.003（降低70%）
  - 障碍物最大数量：5 → 3（减少40%）
  - 让新玩家更容易上手

### 📚 文档更新
- ✅ 创建《问题修复记录.md》- 详细记录修复过程

---

## v2.0 - 管理员设置中心 (2026-02-12)

### 🎉 重大更新

#### ⚙️ 统一管理员设置中心
- ✅ 创建全新的三标签页管理员面板
- ✅ 合并广告位设置、支付设置、游戏参数设置
- ✅ 优化管理员登录流程（简化为prompt输入）
- ✅ 统一的UI设计风格，提升用户体验

#### 🎮 游戏参数可配置系统
- ✅ **金币参数配置**:
  - 生成概率（每帧）：0.001-0.1
  - 最大数量：5-50个
  - 存在时间：5000-30000毫秒
  
- ✅ **钻石道具参数配置**:
  - 生成间隔：30000-300000毫秒
  - 每次生成数量：1-10个
  
- ✅ **障碍物参数配置**:
  - 生成概率：0.001-0.05
  - 最大数量：1-15个
  
- ✅ **加血包参数配置**:
  - 生成间隔：30000-300000毫秒
  
- ✅ 一键恢复默认参数功能

#### 💳 支付设置优化
- ✅ 支持上传支付宝/微信收款码图片
- ✅ 实时图片预览功能
- ✅ Base64编码存储，无需服务器
- ✅ 充值时自动显示管理员设置的收款码

#### 🎯 广告管理增强
- ✅ 图片透明度可配置（0-1）
- ✅ 广告图片保持原始比例显示
- ✅ 优化广告气球列表展示
- ✅ 整合到统一管理面板中

### 🔧 技术改进
- ✅ 删除旧的独立弹窗和按钮
- ✅ 清理未使用的CSS样式
- ✅ 优化代码结构，减少重复
- ✅ 改进localStorage数据管理

### 📚 文档更新
- ✅ 创建《管理员设置说明.md》
- ✅ 创建《管理员面板测试指南.md》
- ✅ 创建《完整功能列表.md》
- ✅ 更新《更新日志.md》

---

## v1.5 - 钻石系统 (2026-02-12)

### 💎 钻石系统
- ✅ 钻石作为游戏积分
- ✅ 充值兑换：0.1元 = 100钻石
- ✅ 金币兑换：100金币 = 1钻石
- ✅ 钻石道具：每100秒生成5个，每个+10钻石
- ✅ 点击钻石区域快速兑换金币

### 📚 文档
- ✅ 创建《钻石系统说明.md》

---

## v1.4 - 支付系统 (2026-02-11)

### 💳 多支付方式
- ✅ 支付宝支付（收款码）
- ✅ 微信支付（收款码）
- ✅ Visa支付（演示模式）
- ✅ Mastercard支付（演示模式）

### ⚙️ 管理员支付设置
- ✅ 单独的支付设置面板
- ✅ 上传支付宝/微信收款码
- ✅ 配置Visa/Mastercard收款信息

### 📚 文档
- ✅ 创建《支付功能使用指南.md》

---

## v1.3 - 生命值系统 (2026-02-10)

### ❤️ 生命值系统
- ✅ 初始生命值：100 HP
- ✅ 闪电云伤害：-10 HP
- ✅ 小鸟伤害：-5 HP
- ✅ 加血包治疗：+20 HP

### 💊 加血包系统
- ✅ 每100秒随机生成2个加血包
- ✅ 白色十字医疗包外观
- ✅ 随机位置生成

### 💀 死亡与复活
- ✅ 生命值≤0触发死亡
- ✅ 钻石复活：消耗100钻石
- ✅ 充值复活：充值0.1元

### 💰 充值系统
- ✅ 充值比例：1元 = 1000钻石
- ✅ 充值弹窗界面
- ✅ 支付方式选择

### 📚 文档
- ✅ 创建《功能说明.md》

---

## v1.2 - 超级马里奥元素 (2026-02-09)

### 🎮 游戏元素
- ✅ 金币系统：收集金币获得积分
- ✅ 障碍物：闪电云、小鸟
- ✅ 碰撞检测
- ✅ 积分榜显示

### 🪙 金币系统
- ✅ 随机位置生成
- ✅ 从右向左移动
- ✅ 12秒后自动消失
- ✅ 消失前2秒闪烁提醒
- ✅ 最多同时存在20个金币

### ⚡ 障碍物系统
- ✅ 闪电云：灰色云朵+黄色闪电
- ✅ 小鸟：蓝色飞鸟
- ✅ 随机生成，横向移动

### 📊 得分系统
- ✅ 金币得分显示
- ✅ 实时更新

---

## v1.1 - 多人同步修复 (2026-02-08)

### 🐛 问题修复
- ✅ 修复多个玩家看不到彼此的问题
- ✅ 优化Supabase实时连接
- ✅ 改进玩家位置同步频率
- ✅ 优化离线玩家清理逻辑

---

## v1.0 - 初始版本 (2026-02-05)

### 🎈 基础游戏功能
- ✅ 像素风热气球绘制
- ✅ 点击移动控制
- ✅ 呼吸浮动效果
- ✅ 飞行倾斜动画

### 🌤️ 场景设计
- ✅ 分层蓝天背景
- ✅ 动态移动云朵
- ✅ 层级管理系统

### 👥 多人在线
- ✅ Supabase Realtime集成
- ✅ 玩家位置实时同步
- ✅ 玩家名称显示
- ✅ 自动离线清理

### 🏷️ 用户系统
- ✅ 自定义玩家名称
- ✅ 欢迎弹窗
- ✅ 更改名字功能
- ✅ 本地存储

### 🎯 广告系统
- ✅ 背景广告气球
- ✅ 文字+图片广告
- ✅ 位置自定义
- ✅ 管理员面板

### 📱 响应式设计
- ✅ 桌面端适配
- ✅ 移动端适配
- ✅ 自适应缩放

### 🚀 部署
- ✅ GitHub仓库创建
- ✅ Vercel自动部署
- ✅ 公网访问

---

## 技术栈变更历史

### v2.0
- 优化CSS模块化
- 改进JavaScript事件管理
- 增强localStorage使用

### v1.0
- Phaser.js 3.x
- Supabase Realtime
- HTML5 + CSS3 + JavaScript (ES6+)
- Vercel部署

---

## 已知问题

### v2.0
- ⚠️ 支付宝/微信支付需手动核验
- ⚠️ Visa/Mastercard为演示模式

### v1.x
- ⚠️ 大量玩家可能影响性能（建议<50人）
- ⚠️ 不支持IE浏览器

---

## 计划中的功能

### 下一版本 (v2.1)
- [ ] 排行榜系统
- [ ] 成就系统
- [ ] 皮肤商店
- [ ] 好友系统

### 未来计划
- [ ] 服务端验证
- [ ] 反作弊系统
- [ ] 关卡系统
- [ ] 道具系统

---

**维护者**: DDKJ Team  
**最后更新**: 2026年2月12日
