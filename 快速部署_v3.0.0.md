# ⚡ 快速部署指南 - v3.0.0 用户注册登录系统

## 🚨 必须先执行！（5分钟）

---

## 第一步：创建用户表

### 1. 打开 Supabase Dashboard

```
https://supabase.com/dashboard/project/ksctfambipodjbrtjaby
```

### 2. 进入 SQL Editor

左侧菜单 → **SQL Editor**

### 3. 复制并运行SQL

打开文件：`setup_users_table.sql`

**或直接复制下面的SQL**：

```sql
-- 创建用户表
CREATE TABLE IF NOT EXISTS public.game_users (
  id SERIAL PRIMARY KEY,
  username TEXT UNIQUE NOT NULL,
  password TEXT NOT NULL,
  country TEXT,
  region TEXT,
  gender TEXT,
  age INTEGER,
  phone TEXT,
  diamonds INTEGER DEFAULT 0,
  coins_collected INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  last_login TIMESTAMP WITH TIME ZONE,
  is_active BOOLEAN DEFAULT true
);

-- 创建索引
CREATE INDEX IF NOT EXISTS idx_users_username ON public.game_users (username);
CREATE INDEX IF NOT EXISTS idx_users_phone ON public.game_users (phone);
CREATE INDEX IF NOT EXISTS idx_users_created_at ON public.game_users (created_at);

-- 启用 RLS
ALTER TABLE public.game_users ENABLE ROW LEVEL SECURITY;

-- 允许读取
CREATE POLICY "允许读取用户信息"
ON public.game_users FOR SELECT TO public USING (true);

-- 允许注册
CREATE POLICY "允许注册新用户"
ON public.game_users FOR INSERT TO public WITH CHECK (true);

-- 允许更新
CREATE POLICY "允许更新用户信息"
ON public.game_users FOR UPDATE TO public USING (true) WITH CHECK (true);
```

### 4. 验证创建成功

运行这条查询：

```sql
SELECT * FROM public.game_users;
```

**预期结果**：看到一个空表（0行）✅

---

## 第二步：等待部署（1-2分钟）

Vercel 会自动检测到代码更新并重新部署。

**访问**：https://my-balloon-game.vercel.app/

**强制刷新**：`Ctrl + F5`

---

## 第三步：测试注册（2分钟）

### 注册新账号

1. 访问游戏，看到登录界面
2. 点击 **"📝 注册新账号"**
3. 填写信息：
   ```
   用户名: test001
   密码: 123456
   确认密码: 123456
   国家: 中国
   地区: 北京
   性别: 男
   年龄: 25
   手机号: 13800138000
   ```
4. 点击 **"✅ 提交注册"**
5. ✅ **检查**：是否提示"注册成功"？
6. ✅ **检查**：是否自动返回登录界面？

### 登录测试

1. 用户名：`test001`
2. 密码：`123456`
3. 点击 **"🚀 登录"**
4. ✅ **检查**：是否提示"欢迎回来，test001！"？
5. ✅ **检查**：是否进入游戏？

---

## 第四步：测试数据持久化（2分钟）

### 玩游戏并测试数据保存

1. 登录后玩游戏
2. 收集一些金币和钻石
3. 记录数量（例如：💎 100，🪙 250）
4. 点击 **"🚪 退出登录"**
5. 刷新页面
6. 重新登录（test001 / 123456）
7. ✅ **检查**：数据是否和之前一样？

---

## 第五步：测试自动登录（1分钟）

1. 登录后玩游戏
2. 关闭浏览器标签页
3. 重新打开游戏链接
4. ✅ **检查**：是否自动登录？
5. ✅ **检查**：是否直接进入游戏？

---

## ✅ 功能验证清单

复制此清单，逐项测试：

```
□ 创建用户表成功
□ 访问游戏看到登录界面
□ 可以点击"注册新账号"
□ 注册表单正常显示
□ 填写信息后可以提交
□ 用户名重复时提示错误
□ 密码不一致时提示错误
□ 注册成功后返回登录界面
□ 可以用注册的账号登录
□ 登录后显示欢迎信息
□ 登录后进入游戏界面
□ 收集金币和钻石
□ 退出登录后数据保存
□ 重新登录后数据正确
□ 关闭浏览器后自动登录
□ 可以正常游戏
```

---

## 🎮 主要变化

### 之前（v2.x）
- ❌ 只需输入名字
- ❌ 数据保存在本地
- ❌ 换设备数据丢失

### 现在（v3.0）
- ✅ 需要注册和登录
- ✅ 数据保存在云端
- ✅ 换设备也能继续游戏
- ✅ 支持用户个人信息
- ✅ 自动登录功能

---

## ⚠️ 注意事项

### 关于密码
- ⚠️ 当前版本密码**明文存储**
- ⚠️ 仅用于演示
- ⚠️ 不要使用真实密码
- ⚠️ 不要输入重要信息

### 关于用户名
- 用户名一旦注册**无法修改**
- 用户名必须**唯一**
- 建议使用简单易记的名字

### 关于数据
- 所有数据保存在**Supabase云端**
- 不会因为清除浏览器缓存而丢失
- 换设备登录也能看到

---

## 🐛 如果出错

### 错误1：表创建失败

**症状**：SQL运行时报错

**解决**：
1. 检查是否连接到正确的项目
2. 尝试先删除旧表：
   ```sql
   DROP TABLE IF EXISTS public.game_users CASCADE;
   ```
3. 重新运行创建脚本

### 错误2：无法注册

**症状**：点击注册没反应

**解决**：
1. 检查用户名和密码是否符合要求
2. 检查密码是否一致
3. 打开Console查看错误信息
4. 检查Supabase表是否创建成功

### 错误3：登录失败

**症状**：提示"用户名或密码错误"

**解决**：
1. 检查用户名是否正确
2. 检查密码是否正确（区分大小写）
3. 在Supabase中查询确认用户存在：
   ```sql
   SELECT * FROM game_users WHERE username = 'test001';
   ```

### 错误4：数据没有保存

**症状**：退出后数据丢失

**解决**：
1. 检查是否登录成功
2. 检查Console是否有保存错误
3. 在Supabase中查询数据：
   ```sql
   SELECT username, diamonds, coins_collected
   FROM game_users WHERE username = 'test001';
   ```

---

## 📊 在Supabase中查看用户

### 查看所有用户

```sql
SELECT 
  id,
  username,
  country,
  diamonds AS 钻石,
  coins_collected AS 金币,
  created_at AS 注册时间,
  last_login AS 最后登录
FROM game_users
ORDER BY created_at DESC;
```

### 查看用户统计

```sql
-- 总用户数
SELECT COUNT(*) AS 总用户数 FROM game_users;

-- 今日新增
SELECT COUNT(*) AS 今日新增 
FROM game_users 
WHERE created_at >= CURRENT_DATE;

-- 钻石排行榜
SELECT username, diamonds
FROM game_users
ORDER BY diamonds DESC
LIMIT 10;
```

---

## 🎉 完成！

如果所有测试通过，说明用户注册登录系统部署成功！

**现在玩家可以**：
- ✅ 注册账号
- ✅ 登录游戏
- ✅ 数据云端保存
- ✅ 换设备继续游戏
- ✅ 自动登录

**管理员可以**：
- ✅ 查看所有用户
- ✅ 查看用户统计
- ✅ 管理用户数据

---

**版本：v3.0.0** | **部署时间：<5分钟** | **测试时间：<5分钟** ⚡
